- content_for :title do
  = "Second Hand Good Transaction"

- content_for :breadcrumb do
  li
    p =t('corner.common.shopkeeper')
  li
    = link_to "Second Hand Good Transaction", {action: "index"}, class: "active"

.panel-body
  .row
    .col-sm-10
      h3 = t('shopkeeper_panel.transaction.page2.msg')
      p = t('shopkeeper_panel.transaction.page2.msg2')
      br
      = form_tag(action: "create", method: "post", class: "form-horizontal")
        = hidden_field_tag(:cuid, @user.cuid)
        = hidden_field_tag(:type, params[:type])
        .form-group
          = label_tag "name", "Name", class: "col-sm-3 control-label"
          .col-sm-9
            = text_field_tag "name", @user.name, class: "form-control", disabled: true
        .form-group
          = label_tag "cuid", "CUID", class: "col-sm-3 control-label"
          .col-sm-9
            = text_field_tag "cuid", @user.cuid, class: "form-control", disabled: true
        .form-group
          = label_tag "current_amount", "Current Amount", class: "col-sm-3 control-label"
          .col-sm-9
            = text_field_tag "current_amount", @user.account.balance, class: "form-control", disabled: true
        .form-group
          table.table
            thead
              tr
                th.col-md-1 #
                th.col-md-7 Type
                th.col-md-2 Price
                th.col-md-2 Quantity
            tbody
              - (1..10).each do |i|
                tr
                  td = i
                  td
                    select.full-width id="good_#{i}" name="good_#{i}" data-init-plugin="select2"
                      optgroup label="-"
                        option value="empty" -
                      - Corner::Pos::SecondHandGoodCategory.all.order_by(:order => 'asc').each do |category|
                        optgroup label="#{(category.order + 64).chr.to_s + " " + category.name}"
                          - category.item.all.order_by(:order => 'asc').each do |item|
                            option value="#{item.number}" = (category.order + 64).chr.to_s + item.order.to_s + " " + item.name
                  td
                    = text_field_tag ("price_"+i.to_s), nil, class: "form-control"
                  td
                    = text_field_tag ("quantity_"+i.to_s), nil, class: "form-control"
        br
        .row
          .col-sm-9.col-sm-offset-3
            = button_tag "Submit", data: { disable_with: t('form.pleasewait') }, class: "btn btn-success"
- content_for :jscode do
  javascript:
    $(document).ready(function() {
      $('#good_1').on('change', function() {
        if (this.value != "empty") {
          $.getJSON('/corner/pos/second_hand_good_transaction/get_price', {good: this.value}, function(data) {
            if ('#{params[:type]}' == 'purchase') {
              $('#price_1').val(data.purchase_credit_price);
            } else {
              $('#price_1').val(data.sale_credit_price);
            }
            $('#quantity_1').val("1");
          });
        } else {
          $('#price_1').val("");
          $('#quantity_1').val("");
        }
      });
      $('#good_2').on('change', function() {
        if (this.value != "empty") {
          $.getJSON('/corner/pos/second_hand_good_transaction/get_price', {good: this.value}, function(data) {
            if ('#{params[:type]}' == 'purchase') {
              $('#price_2').val(data.purchase_credit_price);
            } else {
              $('#price_2').val(data.sale_credit_price);
            }
            $('#quantity_2').val("1");
          });
        } else {
          $('#price_2').val("");
          $('#quantity_2').val("");
        }
      });
      $('#good_3').on('change', function() {
        if (this.value != "empty") {
          $.getJSON('/corner/pos/second_hand_good_transaction/get_price', {good: this.value}, function(data) {
            if ('#{params[:type]}' == 'purchase') {
              $('#price_3').val(data.purchase_credit_price);
            } else {
              $('#price_3').val(data.sale_credit_price);
            }
            $('#quantity_3').val("1");
          });
        } else {
          $('#price_3').val("");
          $('#quantity_3').val("");
        }
      });
      $('#good_4').on('change', function() {
        if (this.value != "empty") {
          $.getJSON('/corner/pos/second_hand_good_transaction/get_price', {good: this.value}, function(data) {
            if ('#{params[:type]}' == 'purchase') {
              $('#price_4').val(data.purchase_credit_price);
            } else {
              $('#price_4').val(data.sale_credit_price);
            }
            $('#quantity_4').val("1");
          });
        } else {
          $('#price_4').val("");
          $('#quantity_4').val("");
        }
      });
      $('#good_5').on('change', function() {
        if (this.value != "empty") {
          $.getJSON('/corner/pos/second_hand_good_transaction/get_price', {good: this.value}, function(data) {
            if ('#{params[:type]}' == 'purchase') {
              $('#price_5').val(data.purchase_credit_price);
            } else {
              $('#price_5').val(data.sale_credit_price);
            }
            $('#quantity_5').val("1");
          });
        } else {
          $('#price_5').val("");
          $('#quantity_5').val("");
        }
      });
      $('#good_6').on('change', function() {
        if (this.value != "empty") {
          $.getJSON('/corner/pos/second_hand_good_transaction/get_price', {good: this.value}, function(data) {
            if ('#{params[:type]}' == 'purchase') {
              $('#price_6').val(data.purchase_credit_price);
            } else {
              $('#price_6').val(data.sale_credit_price);
            }
            $('#quantity_6').val("1");
          });
        } else {
          $('#price_6').val("");
          $('#quantity_6').val("");
        }
      });
      $('#good_7').on('change', function() {
        if (this.value != "empty") {
          $.getJSON('/corner/pos/second_hand_good_transaction/get_price', {good: this.value}, function(data) {
            if ('#{params[:type]}' == 'purchase') {
              $('#price_7').val(data.purchase_credit_price);
            } else {
              $('#price_7').val(data.sale_credit_price);
            }
            $('#quantity_7').val("1");
          });
        } else {
          $('#price_7').val("");
          $('#quantity_7').val("");
        }
      });
      $('#good_8').on('change', function() {
        if (this.value != "empty") {
          $.getJSON('/corner/pos/second_hand_good_transaction/get_price', {good: this.value}, function(data) {
            if ('#{params[:type]}' == 'purchase') {
              $('#price_8').val(data.purchase_credit_price);
            } else {
              $('#price_8').val(data.sale_credit_price);
            }
            $('#quantity_8').val("1");
          });
        } else {
          $('#price_8').val("");
          $('#quantity_8').val("");
        }
      });
      $('#good_9').on('change', function() {
        if (this.value != "empty") {
          $.getJSON('/corner/pos/second_hand_good_transaction/get_price', {good: this.value}, function(data) {
            if ('#{params[:type]}' == 'purchase') {
              $('#price_9').val(data.purchase_credit_price);
            } else {
              $('#price_9').val(data.sale_credit_price);
            }
            $('#quantity_9').val("1");
          });
        } else {
          $('#price_9').val("");
          $('#quantity_9').val("");
        }
      });
      $('#good_10').on('change', function() {
        if (this.value != "empty") {
          $.getJSON('/corner/pos/second_hand_good_transaction/get_price', {good: this.value}, function(data) {
            if ('#{params[:type]}' == 'purchase') {
              $('#price_10').val(data.purchase_credit_price);
            } else {
              $('#price_10').val(data.sale_credit_price);
            }
            $('#quantity_10').val("1");
          });
        } else {
          $('#price_10').val("");
          $('#quantity_10').val("");
        }
      });
    });